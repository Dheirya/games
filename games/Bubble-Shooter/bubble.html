<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Bubble Shooter Game</title><style>body {margin: 0;padding: 0;margin-top: 15px;background-color: #ccc;}</style></head><body oncontextmenu="return false;"><center><canvas id="viewport" width="1256" height="628"></canvas></center><img onclick="window.history.back();window.close();" width="80" style="position:absolute;z-index:99999;right:5px;bottom:15px;" src="https://res.cloudinary.com/dpoer5oaq/image/upload/v1630625180/276-2767433_back-button-white-png-transparent-png-removebg-preview_tjhw7y.png"/><script>window.onload=function(){var e=document.getElementById("viewport"),t=e.getContext("2d");e.width=screen.width-50;var i=0,l=0,r=0,o=0,n=!1;columnsx=Math.round(screen.width/41.8666666667);var h,a={x:4,y:83,width:0,height:0,columns:columnsx,rows:14,tilewidth:40,tileheight:40,rowheight:34,radius:20,tiles:[]},f=function(e,t,i,l){this.x=e,this.y=t,this.type=i,this.removed=!1,this.shift=l,this.velocity=0,this.alpha=1,this.processed=!1},b={x:0,y:0,angle:0,tiletype:0,bubble:{x:0,y:0,angle:0,speed:1e3,dropspeed:900,tiletype:0,visible:!1},nextbubble:{x:0,y:0,tiletype:0}},s=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],u=7,y={init:0,ready:1,shootbubble:2,removecluster:3,gameover:4},c=y.init,d=0,g=0,v=0,p=0,x=!1,w=[],m=[],M=[],S=0,R=0,k=!1;function T(h){if(window.requestAnimationFrame(T),n)!function(e){var t=(h-i)/1e3;i=h,function(e){l>.25&&(o=Math.round(r/l),l=0,r=0),l+=e,r++}(t),c==y.ready||(c==y.shootbubble?function(e){if(b.bubble.x+=e*b.bubble.speed*Math.cos(Y(b.bubble.angle)),b.bubble.y+=e*b.bubble.speed*-1*Math.sin(Y(b.bubble.angle)),b.bubble.x<=a.x?(b.bubble.angle=180-b.bubble.angle,b.bubble.x=a.x):b.bubble.x+a.tilewidth>=a.x+a.width&&(b.bubble.angle=180-b.bubble.angle,b.bubble.x=a.x+a.width-a.tilewidth),b.bubble.y<=a.y)return b.bubble.y=a.y,void V();for(var t=0;t<a.columns;t++)for(var i=0;i<a.rows;i++){if(!(a.tiles[t][i].type<0)){var l=A(t,i);if(X(b.bubble.x+a.tilewidth/2,b.bubble.y+a.tileheight/2,a.radius,l.tilex+a.tilewidth/2,l.tiley+a.tileheight/2,a.radius))return void V()}}}(t):c==y.removecluster&&function(e){if(0==p){!function(){for(var e=0;e<a.columns;e++)for(var t=0;t<a.rows;t++)a.tiles[e][t].removed=!1}();for(var t=0;t<w.length;t++)w[t].removed=!0;if(d+=100*w.length,(m=function(){C();for(var e=[],t=0;t<a.columns;t++)for(var i=0;i<a.rows;i++){if(!a.tiles[t][i].processed){var l=B(t,i,!1,!1,!0);if(l.length<=0)continue;for(var r=!0,o=0;o<l.length;o++)if(0==l[o].y){r=!1;break}r&&e.push(l)}}return e}()).length>0)for(t=0;t<m.length;t++)for(var i=0;i<m[t].length;i++){(r=m[t][i]).shift=0,r.shift=1,r.velocity=b.bubble.dropspeed,d+=100}p=1}if(1==p){var l=!1;for(t=0;t<w.length;t++){(r=w[t]).type>=0&&(l=!0,r.alpha-=15*e,r.alpha<0&&(r.alpha=0),0==r.alpha&&(r.type=-1,r.alpha=1))}for(t=0;t<m.length;t++)for(i=0;i<m[t].length;i++){var r;(r=m[t][i]).type>=0&&(l=!0,r.velocity+=700*e,r.shift+=e*r.velocity,r.alpha-=8*e,r.alpha<0&&(r.alpha=0),(0==r.alpha||r.y*a.rowheight+r.shift>(a.rows-1)*a.rowheight+a.tileheight)&&(r.type=-1,r.shift=0,r.alpha=1))}if(!l){D();var o=!1;for(t=0;t<a.columns;t++)for(i=0;i<a.rows;i++)if(-1!=a.tiles[t][i].type){o=!0;break}I(o?y.ready:y.gameover)}}}(t))}(),function(){L();var e=a.tileheight/2;t.fillStyle="#8c8c8c",t.fillRect(a.x-4,a.y-4,a.width+8,a.height+4-e),function(){for(var e=0;e<a.rows;e++)for(var i=0;i<a.columns;i++){var l=a.tiles[i][e],r=l.shift,o=A(i,e);l.type>=0&&(t.save(),t.globalAlpha=l.alpha,F(o.tilex,o.tiley+r,l.type),t.restore())}}(),t.fillStyle="#656565",t.fillRect(a.x-4,a.y-4+a.height+4-e,a.width+8,2*a.tileheight+3),t.fillStyle="#ffffff",t.font="18px Verdana";var i,l,r=a.x+a.width-150,o=a.y+a.height+a.tileheight-e-8;if(E("Score:",r,o,150),t.font="24px Verdana",E(d,r,o+30,150),x){W(w,255,128,128);for(var n=0;n<m.length;n++){var h=Math.floor(100+100*n/m.length);W(m[n],h,h,h)}}i=b.x+a.tilewidth/2,l=b.y+a.tileheight/2,t.fillStyle="#7a7a7a",t.beginPath(),t.arc(i,l,a.radius+12,0,2*Math.PI,!1),t.fill(),t.lineWidth=2,t.strokeStyle="#8c8c8c",t.stroke(),t.lineWidth=3,t.strokeStyle="#D2B48C",t.beginPath(),t.moveTo(i,l),t.lineTo(i+1.5*a.tilewidth*Math.cos(Y(b.angle)),l-1.5*a.tileheight*Math.sin(Y(b.angle))),t.stroke(),F(b.nextbubble.x,b.nextbubble.y,b.nextbubble.tiletype),b.bubble.visible&&F(b.bubble.x,b.bubble.y,b.bubble.tiletype),c==y.gameover&&(t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(a.x-4,a.y-4,a.width+8,a.height+2*a.tileheight+8-e),t.fillStyle="#ffffff",t.font="24px Verdana",E("Game Over!",a.x,a.y+a.height/2+10,a.width),E("Click to Restart",a.x,a.y+a.height/2+40,a.width))}();else{t.clearRect(0,0,e.width,e.height),L();var f=S/R;t.strokeStyle="#ff8080",t.lineWidth=3,t.strokeRect(18.5,.5+e.height-51,e.width-37,32),t.fillStyle="#ff8080",t.fillRect(18.5,.5+e.height-51,f*(e.width-37),32);var s="Loaded "+S+"/"+R+" images";t.fillStyle="#000000",t.font="16px Verdana",t.fillText(s,18,.5+e.height-63),k&&setTimeout(function(){n=!0},1e3)}}function I(e){c=e,p=0}function V(){var e=function(e,t){var i=Math.floor((t-a.y)/a.rowheight),l=0;return(i+v)%2&&(l=a.tilewidth/2),{x:Math.floor((e-l-a.x)/a.tilewidth),y:i}}(b.bubble.x+a.tilewidth/2,b.bubble.y+a.tileheight/2);e.x<0&&(e.x=0),e.x>=a.columns&&(e.x=a.columns-1),e.y<0&&(e.y=0),e.y>=a.rows&&(e.y=a.rows-1);var t=!1;if(-1!=a.tiles[e.x][e.y].type){for(var i=e.y+1;i<a.rows;i++)if(-1==a.tiles[e.x][i].type){e.y=i,t=!0;break}}else t=!0;if(t){if(b.bubble.visible=!1,a.tiles[e.x][e.y].type=b.bubble.tiletype,P())return;if((w=B(e.x,e.y,!0,!0,!1)).length>=3)return void I(y.removecluster)}++g>=5&&(function(){for(var e=0;e<a.columns;e++)for(var t=0;t<a.rows-1;t++)a.tiles[e][a.rows-1-t].type=a.tiles[e][a.rows-1-t-1].type;for(e=0;e<a.columns;e++)a.tiles[e][0].type=G()}(),g=0,v=(v+1)%2,P())||(D(),I(y.ready))}function P(){for(var e=0;e<a.columns;e++)if(-1!=a.tiles[e][a.rows-1].type)return D(),I(y.gameover),!0;return!1}function B(e,t,i,l,r){l&&C();var o=a.tiles[e][t],n=[o];o.processed=!0;for(var h=[];n.length>0;){var f=n.pop();if(-1!=f.type&&!(r&&f.removed||i&&f.type!=o.type)){h.push(f);for(var b=q(f),s=0;s<b.length;s++)b[s].processed||(n.push(b[s]),b[s].processed=!0)}}return h}function C(){for(var e=0;e<a.columns;e++)for(var t=0;t<a.rows;t++)a.tiles[e][t].processed=!1}function q(e){for(var t=(e.y+v)%2,i=[],l=s[t],r=0;r<l.length;r++){var o=e.x+l[r][0],n=e.y+l[r][1];o>=0&&o<a.columns&&n>=0&&n<a.rows&&i.push(a.tiles[o][n])}return i}function E(e,i,l,r){var o=t.measureText(e);t.fillText(e,i+(r-o.width)/2,l)}function L(){t.fillStyle="#e8eaec",t.fillRect(0,0,e.width,e.height),t.fillStyle="#303030",t.fillRect(0,0,e.width,79),t.fillStyle="#ffffff",t.font="24px Verdana",t.fillText("Bubble Shooter",10,37),t.fillStyle="#ffffff",t.font="12px Verdana",t.fillText("Fps: "+o,13,57)}function W(e,i,l,r){for(var o=0;o<e.length;o++){var n=A(e[o].x,e[o].y);t.fillStyle="rgb("+i+","+l+","+r+")",t.fillRect(n.tilex+a.tilewidth/4,n.tiley+a.tileheight/4,a.tilewidth/2,a.tileheight/2)}}function A(e,t){var i=a.x+e*a.tilewidth;return(t+v)%2&&(i+=a.tilewidth/2),{tilex:i,tiley:a.y+t*a.rowheight}}function F(e,i,l){l<0||l>=u||t.drawImage(h,40*l,0,40,40,e,i,a.tilewidth,a.tileheight)}function j(){d=0,g=0,v=0,I(y.ready),function(){for(var e=0;e<a.rows;e++)for(var t=O(0,u-1),i=0,l=0;l<a.columns;l++){if(i>=2){var r=O(0,u-1);r==t&&(r=(r+1)%u),t=r,i=0}i++,e<a.rows/2?a.tiles[l][e].type=t:a.tiles[l][e].type=-1}}(),D(),D()}function D(){b.tiletype=b.nextbubble.tiletype,b.bubble.tiletype=b.nextbubble.tiletype,b.bubble.x=b.x,b.bubble.y=b.y,b.bubble.visible=!0;var e=G();b.nextbubble.tiletype=e}function G(){existingcolors=function(){for(var e=[],t=[],i=0;i<u;i++)t.push(!1);for(i=0;i<a.columns;i++)for(var l=0;l<a.rows;l++){var r=a.tiles[i][l];r.type>=0&&(t[r.type]||(t[r.type]=!0,e.push(r.type)))}return e}();var e=0;return existingcolors.length>0&&(e=existingcolors[O(0,existingcolors.length-1)]),e}function O(e,t){return Math.floor(e+Math.random()*(t-e+1))}function X(e,t,i,l,r,o){var n=e-l,h=t-r;return Math.sqrt(n*n+h*h)<i+o}function Y(e){return e*(Math.PI/180)}function _(t){var i=H(e,t),l=Math.atan2(b.y+a.tileheight/2-i.y,i.x-(b.x+a.tilewidth/2))*(180/Math.PI);l<0&&(l=180+(180+l)),l>90&&l<270?l>172&&(l=172):(l<8||l>=270)&&(l=8),b.angle=l}function z(t){H(e,t),c==y.ready?(b.bubble.x=b.x,b.bubble.y=b.y,b.bubble.angle=b.angle,b.bubble.tiletype=b.tiletype,I(y.shootbubble)):c==y.gameover&&j()}function H(e,t){var i=e.getBoundingClientRect();return{x:Math.round((t.clientX-i.left)/(i.right-i.left)*e.width),y:Math.round((t.clientY-i.top)/(i.bottom-i.top)*e.height)}}!function(){M=function(e){S=0,R=e.length,k=!1;for(var t=[],i=0;i<e.length;i++){var l=new Image;l.onload=function(){++S==R&&(k=!0)},l.src=e[i],t[i]=l}return t}(["https://res.cloudinary.com/dpoer5oaq/image/upload/v1639441190/bubble-sprites_od45jg.png"]),h=M[0],e.addEventListener("mousemove",_),e.addEventListener("mousedown",z);for(var t=0;t<a.columns;t++){a.tiles[t]=[];for(var i=0;i<a.rows;i++)a.tiles[t][i]=new f(t,i,0,0)}a.width=a.columns*a.tilewidth+a.tilewidth/2,a.height=(a.rows-1)*a.rowheight+a.tileheight,b.x=a.x+a.width/2-a.tilewidth/2,b.y=a.y+a.height,b.angle=90,b.tiletype=0,b.nextbubble.x=b.x-2*a.tilewidth,b.nextbubble.y=b.y,j(),T(0)}()};</script></body></html>